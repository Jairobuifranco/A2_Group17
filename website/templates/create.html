<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Local Concerts â€” Create Event</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <!-- Resolved css link !-->
  <link rel="stylesheet" href="{{ url_for('static', filename='style/styles.css') }}"/>
</head>
<body>
  <!--Navbar-->
  <nav class="navbar navbar-expand-lg bg-white border-bottom">
    <div class="container">
      <a class="navbar-brand fw-bold" href="{{ url_for('main.index') }}"><i class="bi bi-music-note-beamed me-1"></i>Local<span>Concerts</span></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav me-auto">
          <!-- Updated nav-link !-->
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.index') }}">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="{{ url_for('main.create_event') }}" aria-current="page">Create Event</a></li>
          <li class="nav-item"><a class="nav-link active" href="{{ url_for('main.my_events') }}" aria-current="page">My Events</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('main.index') }}">Bookings</a></li>
        </ul>
        <!-- Logged-in indicator -->
        {% if current_user.is_authenticated %}
        <span class="badge text-bg-success">Signed in as {{ current_user.name }}</span>
        <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-secondary btn-sm ms-2">Logout</a>
        {% else %}
        <span class="badge text-bg-warning">Not Signed in</span>
        {% endif %}
      </div>
    </div>
  </nav>
  <!--Create Event form-->
  <main class="container py-4">
     {% with messages = get_flashed_messages(with_categories=True) %}
              {% if messages %}
                {% for category, message in messages %}
                  {% set alert_class = category if category in ['primary','secondary','success','danger','warning','info','light','dark'] else 'info' %}
                  <div class="alert alert-{{ alert_class }} mb-4" role="alert">
                    {{ message }}
                  </div>
                {% endfor %}
              {% endif %}
            {% endwith %}

    <!-- Welcome message !-->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h3 class="mb-1">Welcome to Local Concerts!</h3>
        <p class="text-muted mb-0">Fill out the form below to create an amazing concert</p>
      </div>

      <!-- My Events button !-->
       <a href="{{ url_for('main.my_events') }}" class="btn btn-outline-primary">
        <i class="bi bi-calendar-event me-1"></i>  My Events
       </a>
    </div>

<!-- Buttons:Create, Update, Cancel !-->
<form class="needs-validation" action="{% if action == 'Update Event' %}{{ url_for('main.update_event', event_id=event.id) }}
{% else %}{{ url_for('main.create_event') }}
 {% endif %}" method="post" enctype="multipart/form-data">
  {{ form.hidden_tag() }}

      <!-- Event name !-->
      <div class="row g-3">
        <div class="col-12 col-md-6">
          {% set title_classess = "form-control" %}
          {% if form.title.errors %}
             {% set title_classess = title_classess + " is-invalid" %}
             {% endif %}
          <label class="form-label">Event Name</label>
          {{ form.title(class=title_classess) }}
          {% if form.title.errors %}
          <div class="invalid-feedback">
            {% for error in form.title.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

      <!-- Venue !-->
        <div class="col-12 col-md-6">
          {% set venue_classess = "form-control" %}
          {% if form.venue.errors %}
             {% set venue_classess = venue_classess + " is-invalid" %}
             {% endif %}
          <label class="form-label">Venue</label>
          {{ form.venue(class=venue_classess) }}
          {% if form.venue.errors %}
          <div class="invalid-feedback">
            {% for error in form.venue.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Description !-->
        <div class="col-12">
          {% set description_classess = "form-control" %}
          {% if form.description.errors %}
             {% set description_classess = description_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">Description</label>
         {{ form.description(class=description_classess, rows="3") }}
          {% if form.description.errors %}
          <div class="invalid-feedback">
            {% for error in form.description.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Date, Start Time, End Time !-->
        <div class="col-6 col-md-3">
          {% set date_classess = "form-control" %}
          {% if form.date.errors %}
            {% set date_classess = date_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">Date</label>
         {{ form.date(class=date_classess) }}
         {% if form.date.errors %}
          <div class="invalid-feedback">
            {% for error in form.date.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="col-6 col-md-3">
          {% set start_time_classess = "form-control" %}
          {% if form.start_time.errors %}
            {% set start_time_classess = start_time_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">Start Time</label>
           {{ form.start_time(class=start_time_classess) }}
          {% if form.start_time.errors %}
          <div class="invalid-feedback">
            {% for error in form.start_time.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <div class="col-6 col-md-3">
          {% set end_time_classess = "form-control" %}
          {% if form.end_time.errors %}
            {% set end_time_classess = end_time_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">End Time</label>
          {{ form.end_time(class=end_time_classess) }}
          {% if form.end_time.errors %}
          <div class="invalid-feedback">
            {% for error in form.end_time.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- General Price !-->
        <div class="col-6 col-md-3">
          {% set general_price_classess = "form-control" %}
          {% if form.general_price.errors %}
            {% set general_price_classess = general_price_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">General Price (AUD)</label>
         {{ form.general_price(class=general_price_classess, min="0", step="0.01") }}
          {% if form.general_price.errors %}
          <div class="invalid-feedback">
            {% for error in form.general_price.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

         <!-- Add general tickets  !-->
          <div class="col-6 col-md-3">
          {% set general_tickets_classess = "form-control" %}
          {% if form.general_tickets.errors %}
            {% set general_tickets_classess = general_tickets_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">General Tickets</label>
        {{ form.general_tickets(class=general_tickets_classess, min="1", max="5000") }}
          {% if form.general_tickets.errors %}
          <div class="invalid-feedback">
            {% for error in form.general_tickets.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- VIP Price !-->
        <div class="col-6 col-md-3">
          {% set vip_price_classess = "form-control" %}
          {% if form.vip_price.errors %}
            {% set vip_price_classess = vip_price_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">VIP Price (AUD)</label>
         {{ form.vip_price(class=vip_price_classess, min="0", step="0.01") }}
          {% if form.vip_price.errors %}
          <div class="invalid-feedback">
            {% for error in form.vip_price.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

         <!-- Add VIP tickets  !-->
          <div class="col-6 col-md-3">
          {% set vip_tickets_classess = "form-control" %}
          {% if form.vip_tickets.errors %}
            {% set vip_tickets_classess = vip_tickets_classess + " is-invalid" %}
          {% endif %}
          <label class="form-label">VIP Tickets</label>
        {{ form.vip_tickets(class=vip_tickets_classess, min="1", max="5000") }}
          {% if form.vip_tickets.errors %}
          <div class="invalid-feedback">
            {% for error in form.vip_tickets.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <!-- category !-->
        <div class="col-12 col-md-6">
        {% set category_classess = "form-select" %}
        {% if form.category.errors %}
        {% set category_classess = category_classess + " is-invalid" %}
        {% endif %}
        <label class="form-label">Category</label>
        {{ form.category(class=category_classess) }}
        {% if form.category.errors %}
        <div class="invalid-feedback">
            {% for error in form.category.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Images Handling !-->
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h6 class="mb-0">Event Image</h6>
            </div>
            <!-- Upload image locally !-->
            <div class="card-body">
            <div class="mb-3">
             {% set image_file_classess = "form-control" %}
             {% if form.image_file.errors %}
               {% set image_file_classess = image_file_classess + " is-invalid" %}
               {% endif %}
              <label class="form-label">Upload Image</label>
              {{ form.image_file(class="form-control") }}
              {% if form.image_file.errors %}
              <div class="invalid-feedback">
                {% for error in form.image_file.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <small class="form-text text-muted">Supported images: JPG, JPEG, PNG, GIF</small>
            </div>

            <!-- Or Separator !-->
             <div class="text-center my-3">
              <span class="text-muted">- OR -</span>
             </div>

             <!-- Alternative: Users can copy image URL !-->
              <div>
            {% set image_url_classess = "form-control" %}
             {% if form.image_url.errors %}
               {% set image_url_classess = image_url_classess + " is-invalid" %}
               {% endif %}
                <label class="form-label">Enter Image URL</label>
                {{ form.image_url(class=image_url_classess, placeholder="https://example.com/image.jpg") }}
                {% if form.image_url.errors %}
                <div class="invalid-feedback">
                {% for error in form.image_url.errors %}
                {{ error }}
                {% endfor %}
               </div>
                {% endif %}
                <small class="form-text text-muted">Leave it as default</small>
              </div>

              <!-- Prefill current image !-->
               {% if action == 'Update Event' and event.image_url %}
               <div class="mt-3">
                <label class="form-label">Current Image:</label>
                <div>
                  {% if event.image_url.startswith('http') %}
                  <img src="{{ event.image_url }}" class="img-thumbnail" style="max-height: 150px;" alt="Current Event Image">
                  {% else %}
                  <img src="{{ url_for('static', filename=event.image_url) }}" class="img-thumbnail" style="max-height: 150px;" alt="Current Event Image">
                  {% endif %}
                </div>
               </div>
               {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons: Update !-->
     <div class="d-flex gap-2 mt-4">
      {{ form.submit(class="btn btn-primary") }}

        {% if action == 'Update Event' %}
        <button type="submit" class="btn btn-success">
          <i class="bi bi-pencil-square"></i> Update Event</button> 
        {% endif %}
        
        <!-- Return My Events !-->
         <a class="btn btn-outline-secondary" href="{{ url_for('main.my_events') }}">
          <i class="bi bi-calendar-event"></i> My Events</a> 
      </div>
    </form>  
  </main>

  <!--Footer-->
  <footer class="py-4 bg-white border-top">
    <div class="container d-flex justify-content-between align-items-center">
      <span class="text-muted small">&copy; <span>2025</span> LocalConcerts</span>
      <a class="small text-decoration-none" href="#">Terms & Privacy</a>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>